# Authentication Testing Guide for Scripture Voice

This guide will help you test the authentication system of your Scripture Voice app to ensure it's working correctly.

## Prerequisites

Before testing, make sure:

1. Your Firebase project is set up correctly with Authentication enabled
2. Email/Password authentication is enabled in the Firebase console
3. The app is connected to Firebase with the correct `google-services.json` file
4. You have a test email that you can access (for verification emails)

## Test Cases

### 1. Registration Flow

#### Test Registration UI

- **Action**: Launch the app and navigate to the registration screen
- **Expected**: All form fields (username, email, password, confirm password) should be visible
- **Verify**: The register button and "Already have an account?" link are functional

#### Test Form Validation

- **Action**: Try submitting the form with invalid inputs:
  - Empty fields
  - Invalid email format
  - Short password (less than 6 characters)
  - Password without numbers/special characters
  - Mismatched passwords
- **Expected**: Appropriate error messages appear for each validation failure
- **Verify**: Form prevents submission until all validation passes

#### Test Successful Registration

- **Action**: Fill out the form with valid information and submit
- **Expected**: Progress indicator appears during submission, then redirects to verification screen
- **Verify**: A new user is created in Firebase Authentication

### 2. Email Verification Flow

#### Test Verification UI

- **Action**: Complete registration and land on the verification screen
- **Expected**: The screen shows the registered email address
- **Verify**: All buttons (resend, check verification, back to login, change email) are visible

#### Test Verification Email Sending

- **Action**: Click "Resend Verification Email"
- **Expected**: Success toast appears, and email is sent
- **Verify**: Verification email arrives in the inbox

#### Test Verification Check

- **Action**: Verify email via the link in the email, then click "I've Verified My Email"
- **Expected**: User is redirected to the main app screen (Room Controls)
- **Verify**: The user's email is marked as verified in Firebase

### 3. Login Flow

#### Test Login UI

- **Action**: Launch the app or navigate to login screen
- **Expected**: Email and password fields are visible along with login button
- **Verify**: "Don't have an account?" and "Forgot Password?" links are functional

#### Test Form Validation

- **Action**: Try submitting with:
  - Empty email
  - Empty password
  - Invalid email format
- **Expected**: Appropriate error messages appear
- **Verify**: Form prevents submission until validation passes

#### Test Login with Unverified Email

- **Action**: Login with credentials for an unverified account
- **Expected**: Login is successful but redirects to verification screen
- **Verify**: User's verification status is checked correctly

#### Test Login with Verified Email

- **Action**: Login with credentials for a verified account
- **Expected**: Login is successful and redirects to Room Controls
- **Verify**: User session is properly stored

### 4. Password Reset Flow

#### Test Password Reset Request

- **Action**: Click "Forgot Password?" and enter a registered email
- **Expected**: Success toast appears
- **Verify**: Password reset email is sent to the inbox

#### Test Password Reset Email

- **Action**: Click the reset link in the email
- **Expected**: Firebase password reset page opens
- **Verify**: Able to set a new password

#### Test Login with New Password

- **Action**: Try logging in with the new password
- **Expected**: Login is successful
- **Verify**: Old password no longer works

### 5. Logout Flow

#### Test Logout Functionality

- **Action**: Click the logout button in Room Controls
- **Expected**: User is logged out and redirected to login screen
- **Verify**: Session data is cleared

### 6. Session Persistence

#### Test Session Persistence

- **Action**: Login with verified account, then kill and restart the app
- **Expected**: User remains logged in and is taken directly to Room Controls
- **Verify**: Session is properly stored in DataStore

#### Test Email Verification Persistence

- **Action**: Login with unverified account, verify email, then restart app
- **Expected**: User should now go directly to Room Controls instead of verification screen
- **Verify**: Email verification status is properly updated

## Edge Cases to Test

### 1. Network Errors

- **Action**: Turn off internet connection and try to login/register
- **Expected**: Appropriate error messages appear
- **Verify**: App doesn't crash and handles errors gracefully

### 2. Firebase Authentication Errors

- **Action**: Try to register with an email that already exists
- **Expected**: Error message about existing account appears
- **Verify**: Error is properly displayed to the user

### 3. Background and Foreground Testing

- **Action**: Login, put app in background for extended period, then return
- **Expected**: User should still be logged in
- **Verify**: Session is properly maintained

### 4. Cancellation Testing

- **Action**: Start registration/login process then navigate back
- **Expected**: Process is cancelled, and no partial actions occur
- **Verify**: No orphaned authentication attempts in Firebase

## Troubleshooting Tips

1. **Firebase Console**: Check the Authentication section in Firebase Console to see if users are being created and email verification statuses are being updated.

2. **Logcat**: Look for logs with the TAG names from each class:

   - "LoginFragment"
   - "RegisterFragment"
   - "VerificationFragment"
   - "UserRepository"

3. **Test Accounts**: Keep a record of test email accounts you create to avoid confusion.

4. **Firebase Rules**: If you're having issues with Firestore operations, check your Firestore rules.

5. **Email Delays**: Sometimes verification emails can be delayed or sent to spam folders.

## Reporting Issues

When reporting issues, include:

1. The specific test case that failed
2. Steps to reproduce
3. Expected vs actual behavior
4. Any error messages from Logcat
5. Screenshots if applicable